# 长下影线策略 - 振幅要求调整

## 更新时间
2025-12-09 16:18

## 更新内容

### 📊 **参数调整**

将长下影线策略的振幅要求从 **5%** 降低到 **2%**

**调整原因**：
- 降低筛选门槛，增加符合条件的股票数量
- 2%的振幅已经能够体现一定的波动性
- 更容易捕捉到潜在的反转信号

### ✅ **已完成的修改**

#### 1. 后端策略代码
**文件**: `backend_api/stock/long_lower_shadow_strategy.py`

**修改位置**：
- 第8行：文件顶部策略说明
- 第131行：`check_conditions` 函数文档字符串
- 第172行：振幅检查逻辑（核心代码）
- 第227行：`screening_long_lower_shadow_strategy` 函数文档字符串

**核心代码修改**：
```python
# 修改前
if amplitude <= 0.05:  # 振幅必须超过 5%
    continue

# 修改后
if amplitude <= 0.02:  # 振幅必须超过 2%
    continue
```

#### 2. 后端API路由
**文件**: `backend_api/stock/stock_screening_routes.py`

**修改内容**：
- 添加振幅条件说明到API文档字符串
- 明确标注振幅要求为2%

**修改位置**: 第257-271行

#### 3. 前端HTML
**文件**: `frontend/screening.html`

**修改内容**：
- 更新策略说明卡片中的振幅要求
- 从"出现长下影线当日振幅超过5%"改为"出现长下影线当日振幅超过2%"

**修改位置**: 第321行

### 📋 **策略完整条件（更新后）**

**长下影线策略**现在包含以下条件：

1. ✅ **股票范围**：
   - 全部A股
   - 排除创业板（3开头）
   - 排除科创板（688开头）
   - 排除北证A股（9开头）

2. ✅ **下跌趋势**：
   - 当日最低价 < MA20（20日移动平均线）

3. ✅ **长下影线**（最近2个交易日内出现）：
   - 阳线或阴线均可
   - 下影线长度 >= 实体长度的1倍
   - 上影线很短或几乎没有（<= 实体长度的30%）
   - **出现长下影线当日振幅超过2%** ⬅️ **已修改**

### 📊 **预期影响**

降低振幅要求后：
- ✅ **增加筛选结果**：符合条件的股票数量会增加
- ✅ **更早捕捉信号**：能够更早发现潜在的反转机会
- ⚠️ **可能增加噪音**：需要结合其他条件综合判断

### 🔍 **振幅计算公式**

```python
振幅 = (最高价 - 最低价) / 昨日收盘价

# 示例：
# 昨日收盘价：10.00元
# 当日最高价：10.25元
# 当日最低价：9.95元
# 振幅 = (10.25 - 9.95) / 10.00 = 0.03 = 3%
# 3% > 2%，满足条件 ✓
```

### 📈 **振幅要求对比**

| 振幅要求 | 适用场景 | 筛选结果 |
|---------|---------|---------|
| 5% | 大幅波动，强烈信号 | 较少，信号强 |
| **2%** ⬅️ | **适度波动，早期信号** | **较多，覆盖面广** |
| 1% | 微小波动 | 很多，噪音大 |

### ✅ **验证清单**

- [x] 后端策略代码已修改（4处）
- [x] API文档已更新
- [x] 前端界面已更新
- [x] 所有文档字符串已同步
- [x] 振幅检查逻辑已修改

### 📝 **相关文件**

1. `backend_api/stock/long_lower_shadow_strategy.py` - 策略实现
2. `backend_api/stock/stock_screening_routes.py` - API路由
3. `frontend/screening.html` - 前端界面

### 💡 **使用说明**

修改已生效，无需额外操作。下次运行长下影线选股策略时：
- ✅ 振幅要求自动降低到2%
- ✅ 会筛选出更多符合条件的股票
- ✅ 前端界面会显示更新后的说明

### 🔄 **回滚方法**

如果需要恢复到5%的振幅要求，修改以下位置：
```python
# backend_api/stock/long_lower_shadow_strategy.py 第172行
if amplitude <= 0.05:  # 改回 0.05
    continue
```

### 📊 **测试建议**

1. **对比测试**：
   - 记录修改前的筛选结果数量
   - 运行修改后的策略
   - 对比结果数量变化

2. **质量评估**：
   - 检查新增股票的质量
   - 验证是否符合长下影线形态
   - 评估振幅在2-5%之间的股票表现

3. **回测验证**：
   - 对历史数据进行回测
   - 比较2%和5%振幅要求的效果
   - 评估哪个参数更适合当前市场

## 总结

✅ **长下影线策略振幅要求已从5%降低到2%**  
✅ **所有相关文件已同步更新**  
✅ **预期会筛选出更多符合条件的股票**  

这个调整使策略能够更早地捕捉到潜在的反转信号，同时保持其他筛选条件不变，确保信号质量。
