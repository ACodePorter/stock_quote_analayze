# 股票新闻模型

<cite>
**本文档引用的文件**
- [stock_news.py](file://backend_api/stock/stock_news.py)
- [models.py](file://backend_api/models.py)
- [news_collector.py](file://backend_core/data_collectors/news_collector.py)
- [news.html](file://frontend/news.html)
- [news.js](file://frontend/js/news.js)
</cite>

## 目录
1. [简介](#简介)
2. [项目结构](#项目结构)
3. [核心组件](#核心组件)
4. [架构概述](#架构概述)
5. [详细组件分析](#详细组件分析)
6. [依赖分析](#依赖分析)
7. [性能考虑](#性能考虑)
8. [故障排除指南](#故障排除指南)
9. [结论](#结论)

## 简介
本文档详细阐述了股票新闻模型的设计与实现，围绕`StockNews`实体及其在`stock_news`表中的具体实现展开。重点描述了新闻标题、内容和摘要的文本处理机制，以及关键词提取和情感评级的智能分析流程。说明了信息来源和目标价字段在投资情绪判断中的作用，解释了发布时间与创建时间的区别及其在数据同步中的意义。涵盖了新闻类型分类体系和URL链接的去重策略，并通过实际数据样例展示该模型如何支撑舆情监控和事件驱动型分析，以及其与前端新闻展示组件的集成方式。

## 项目结构
本项目采用分层架构设计，主要分为前端、后端API和核心业务逻辑三个部分。前端负责用户界面展示和交互，后端API提供RESTful接口服务，核心业务逻辑处理数据采集和存储。

```mermaid
graph TD
subgraph "前端"
news_html[news.html]
news_js[news.js]
end
subgraph "后端API"
stock_news_py[stock_news.py]
models_py[models.py]
end
subgraph "核心业务"
news_collector_py[news_collector.py]
end
news_js --> stock_news_py
stock_news_py --> news_collector_py
news_collector_py --> models_py
```

**图表来源**
- [news.html](file://frontend/news.html)
- [news.js](file://frontend/js/news.js)
- [stock_news.py](file://backend_api/stock/stock_news.py)
- [news_collector.py](file://backend_core/data_collectors/news_collector.py)
- [models.py](file://backend_api/models.py)

**章节来源**
- [news.html](file://frontend/news.html)
- [news.js](file://frontend/js/news.js)
- [stock_news.py](file://backend_api/stock/stock_news.py)
- [news_collector.py](file://backend_core/data_collectors/news_collector.py)
- [models.py](file://backend_api/models.py)

## 核心组件
股票新闻模型的核心组件包括`StockNews`实体、新闻采集器、去重算法和前端展示组件。这些组件协同工作，实现了从数据采集到用户展示的完整流程。

**章节来源**
- [stock_news.py](file://backend_api/stock/stock_news.py#L1-L100)
- [models.py](file://backend_api/models.py#L1-L50)
- [news_collector.py](file://backend_core/data_collectors/news_collector.py#L1-L50)

## 架构概述
系统采用典型的三层架构，前端通过API调用获取数据，后端API协调数据处理和存储，核心业务模块负责数据采集和清洗。

```mermaid
graph TD
A[前端] --> B[后端API]
B --> C[核心业务]
C --> D[数据库]
D --> B
B --> A
```

**图表来源**
- [stock_news.py](file://backend_api/stock/stock_news.py#L1-L20)
- [models.py](file://backend_api/models.py#L1-L10)

## 详细组件分析

### StockNews实体分析
`StockNews`实体是整个系统的核心数据结构，定义了股票相关新闻的所有属性。

```mermaid
classDiagram
class StockNews {
+id : Integer
+stock_code : String
+title : String
+content : Text
+keywords : String
+publish_time : DateTime
+source : String
+url : String
+summary : Text
+type : String
+rating : String
+target_price : String
+created_at : DateTime
}
```

**图表来源**
- [models.py](file://backend_api/models.py#L300-L320)

**章节来源**
- [models.py](file://backend_api/models.py#L300-L320)

### 文本处理机制分析
系统对新闻标题、内容和摘要进行了一系列处理，确保数据质量和一致性。

#### 标题和内容处理
```mermaid
flowchart TD
Start([开始]) --> CleanTitle["清理标题特殊字符"]
CleanTitle --> CheckLength["检查标题长度"]
CheckLength --> |长度<2| ReturnError["返回错误"]
CheckLength --> |长度>=2| ProcessContent["处理内容文本"]
ProcessContent --> RemoveHTML["移除HTML标签"]
RemoveHTML --> ExtractSummary["提取摘要"]
ExtractSummary --> End([结束])
```

**图表来源**
- [news_collector.py](file://backend_core/data_collectors/news_collector.py#L150-L200)

#### 关键词提取和情感分析
```mermaid
sequenceDiagram
participant Frontend as "前端"
participant API as "API服务"
participant Collector as "采集器"
Frontend->>API : 请求股票新闻
API->>Collector : 调用采集接口
Collector->>Collector : 分析标题和内容
Collector->>Collector : 提取关键词
Collector->>Collector : 判断情感评级
Collector-->>API : 返回处理结果
API-->>Frontend : 返回新闻数据
```

**图表来源**
- [stock_news.py](file://backend_api/stock/stock_news.py#L50-L100)
- [news_collector.py](file://backend_core/data_collectors/news_collector.py#L100-L150)

**章节来源**
- [stock_news.py](file://backend_api/stock/stock_news.py#L50-L100)
- [news_collector.py](file://backend_core/data_collectors/news_collector.py#L100-L150)

### 时间字段分析
系统中存在两个关键的时间字段：发布时间和创建时间，它们具有不同的含义和用途。

```mermaid
erDiagram
STOCK_NEWS {
string stock_code PK
string title
text content
string keywords
datetime publish_time
string source
string url
text summary
string type
string rating
string target_price
datetime created_at
}
```

**图表来源**
- [models.py](file://backend_api/models.py#L300-L320)

**章节来源**
- [models.py](file://backend_api/models.py#L300-L320)

### 前端集成分析
前端组件与后端API紧密集成，实现了新闻的展示和交互功能。

```mermaid
sequenceDiagram
participant User as "用户"
participant Frontend as "前端"
participant Backend as "后端"
User->>Frontend : 访问新闻页面
Frontend->>Frontend : 加载页面结构
Frontend->>Backend : 请求新闻数据
Backend-->>Frontend : 返回新闻列表
Frontend->>Frontend : 渲染新闻列表
User->>Frontend : 点击新闻标题
Frontend->>Backend : 请求新闻详情
Backend-->>Frontend : 返回新闻详情
Frontend->>Frontend : 显示新闻详情
```

**图表来源**
- [news.html](file://frontend/news.html#L1-L50)
- [news.js](file://frontend/js/news.js#L1-L100)

**章节来源**
- [news.html](file://frontend/news.html#L1-L50)
- [news.js](file://frontend/js/news.js#L1-L100)

## 依赖分析
系统各组件之间存在明确的依赖关系，确保了功能的完整性和数据的一致性。

```mermaid
graph TD
news_html --> news_js
news_js --> stock_news_py
stock_news_py --> news_collector_py
stock_news_py --> models_py
news_collector_py --> models_py
```

**图表来源**
- [news.html](file://frontend/news.html)
- [news.js](file://frontend/js/news.js)
- [stock_news.py](file://backend_api/stock/stock_news.py)
- [news_collector.py](file://backend_core/data_collectors/news_collector.py)
- [models.py](file://backend_api/models.py)

**章节来源**
- [news.html](file://frontend/news.html)
- [news.js](file://frontend/js/news.js)
- [stock_news.py](file://backend_api/stock/stock_news.py)
- [news_collector.py](file://backend_core/data_collectors/news_collector.py)
- [models.py](file://backend_api/models.py)

## 性能考虑
系统在设计时充分考虑了性能因素，特别是在数据采集和处理方面。

- **数据去重**：通过`deduplicate_news`函数实现新闻去重，优先保留东方财富网的新闻。
- **缓存机制**：系统会定期清理30天前的旧新闻，保持数据库的高效运行。
- **异步处理**：API接口采用异步方式处理请求，提高响应速度。

## 故障排除指南
当系统出现异常时，可以参考以下常见问题的解决方案：

**章节来源**
- [stock_news.py](file://backend_api/stock/stock_news.py#L800-L900)
- [news_collector.py](file://backend_core/data_collectors/news_collector.py#L400-L420)

## 结论
股票新闻模型通过精心设计的实体结构和高效的处理流程，实现了对股票相关新闻的全面管理和智能分析。系统不仅能够准确提取关键信息，还能有效判断投资情绪，为用户提供有价值的决策支持。前端与后端的紧密集成确保了用户体验的流畅性，使得舆情监控和事件驱动型分析成为可能。