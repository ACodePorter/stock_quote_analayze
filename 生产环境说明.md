# 股票分析系统生产环境说明文档

## 1. 数据库配置 (PostgreSQL)

### 1.1 数据库服务器信息
- **服务器IP**: 192.168.16.4
- **数据库名称**: stock_analysis
- **数据库密码**: qidianspacetime$91
- **数据库端口**: 5432
- **数据库目录**: C:\Program Files\PostgreSQL\17\data

### 1.2 数据库连接信息
- **连接URL**: postgresql+psycopg2://postgres:qidianspacetime$91@192.168.16.4:5432/stock_analysis
- **用户名**: postgres
- **密码**: qidianspacetime$91

## 2. Nginx 配置

### 2.1 Nginx服务器信息
- **服务器IP**: 192.168.16.4
- **HTTP端口**: 80
- **HTTPS端口**: 443
- **配置文件路径**: C:\work\stock_quote_analayze\tools\nginx-1.28.0\conf\nginx.conf
- **SSL证书目录**: C:\work\stock_quote_analayze\tools\nginx\ssl

### 2.2 Nginx反向代理配置
- **前端应用代理**: 端口8000
- **管理后台代理**: 端口8001
- **后端API代理**: 端口5000

## 3. 应用配置

### 3.1 前端应用 (Frontend)
- **服务器IP**: 192.168.16.4
- **服务端口**: 8000
- **访问域名**: www.icemaplecity.com
- **应用目录**: C:\work\stock_quote_analayze\run\frontend
- **启动命令**: python start_frontend.py
- **访问路径**: https://www.icemaplecity.com/

### 3.2 管理后台 (Admin-Modern)
- **服务器IP**: 192.168.16.4
- **服务端口**: 8001
- **访问域名**: www.icemaplecity.com
- **应用目录**: C:\work\stock_quote_analayze\run\admin-modern
- **启动命令**: python -m http.server 8001
- **访问路径**: https://www.icemaplecity.com/admin

### 3.3 后端API (Backend-API)
- **服务器IP**: 192.168.16.4
- **服务端口**: 5000
- **应用目录**: C:\work\stock_quote_analayze\run\backend_api
- **启动命令**: python run.py
- **API基础路径**: https://www.icemaplecity.com/api

### 3.4 数据采集模块 (Backend-Core)
- **服务器IP**: 192.168.16.4
- **应用目录**: C:\work\stock_quote_analayze\run\backend_core
- **功能**: 数据采集和存储
- **无端口服务**: 后台任务处理

## 4. 系统架构说明

### 4.1 网络架构
```
外部访问 → Nginx反向代理 → 应用服务
用户浏览器 → www.icemaplecity.com → 192.168.16.4:80/443
```

### 4.2 服务端口分配
- **Nginx**: 80 (HTTP), 443 (HTTPS)
- **前端应用**: 8000
- **管理后台**: 8001
- **后端API**: 5000
- **PostgreSQL**: 8432

### 4.3 数据流向
1. **用户访问**: 浏览器 → Nginx (80/443)
2. **页面服务**: Nginx → 前端应用 (8000) / 管理后台 (8001)
3. **API调用**: 前端/管理后台 → Nginx → 后端API (5000)
4. **数据存储**: 后端API → PostgreSQL (8432)
5. **数据采集**: 数据采集模块 → PostgreSQL (8432)

## 5. 部署目录结构

### 5.1 根目录
```
C:\work\stock_quote_analayze\
├── run\                  # 运行目录
│   ├── frontend\         # 前端应用
│   ├── admin-modern\     # 管理后台
│   ├── backend_api\      # 后端API
│   └── backend_core\     # 数据采集
├── tools\                # 工具目录
│   ├── nginx-1.28.0\     # Nginx配置
│   └── nginx\ssl\        # SSL证书
└── docs\                 # 文档目录
```

### 5.2 数据库目录
```
C:\Program Files\PostgreSQL\17\

```

## 6. 启动顺序

### 6.1 服务启动顺序
1. **PostgreSQL数据库**: 确保数据库服务运行
2. **后端API**: 启动后端API服务 (端口5000)
3. **前端应用**: 启动前端应用服务 (端口8000)
4. **管理后台**: 启动管理后台服务 (端口8001)
5. **Nginx**: 启动Nginx反向代理服务 (端口80/443)

### 6.2 启动命令
```bash
# 1. 启动后端API
cd C:\work\stock_quote_analayze\run\backend_api
python run.py

# 2. 启动前端应用
cd C:\work\stock_quote_analayze\run\frontend
python start_frontend.py

# 3. 启动管理后台
cd C:\work\stock_quote_analayze\run\admin-modern
python -m http.server 8001

# 4. 启动Nginx
cd C:\work\stock_quote_analayze\tools\nginx-1.28.0
nginx.exe

# 5. 启动数据采集后端
cd C:\work\stock_quote_analayze\run\backend_core
python -m backend_core.data_collectors.main

#历史数据采集--指定日期
python -m backend_core.data_collectors.tushare.main --type historical --date yyyymmmdd

#历史数据采集--指定日期、文件类型
python -m backend_core.data_collectors.tushare.main --type historical_import_from_file --date yyyymmmdd --file_type 'txt'||'csv'


```

## 7. 访问地址

### 7.1 生产环境访问地址
- **前端应用**: https://www.icemaplecity.com/
- **管理后台**: https://www.icemaplecity.com/admin
- **API接口**: https://www.icemaplecity.com/api

### 7.2 开发环境访问地址
- **前端应用**: http://192.168.16.4:8000
- **管理后台**: http://192.168.16.4:8001
- **API接口**: http://192.168.16.4:5000/api

## 8. 监控和维护

### 8.1 服务监控
- **端口监控**: 检查各服务端口是否正常监听
- **日志监控**: 查看各应用日志文件
- **数据库监控**: 检查数据库连接和性能

### 8.2 日志文件位置
- **Nginx日志**: C:\work\stock_quote_analayze\tools\nginx-1.28.0\logs\
- **应用日志**: 各应用目录下的logs文件夹
- **数据库日志**: C:\Program Files\PostgreSQL\17\data\pg_log\

### 8.3 备份策略
- **数据库备份**: 定期备份PostgreSQL数据库
- **应用备份**: 备份应用代码和配置文件
- **SSL证书备份**: 备份SSL证书文件







