<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªè‚¡è¯¦æƒ… - è‚¡ç¥¨åˆ†æ</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/stock.css">
    <!-- EChartsåº“ - ä¼˜å…ˆä½¿ç”¨æœ¬åœ°æ–‡ä»¶ï¼Œå¤±è´¥æ—¶ä½¿ç”¨CDN -->
    <script src="js/echarts.min.js" onerror="this.onerror=null;this.src='https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js';"></script>
</head>
<body>
    <!-- å¤´éƒ¨å¯¼èˆªå°†ç”±JavaScriptåŠ¨æ€åŠ è½½ -->

    <!-- ä¸»è¦å†…å®¹ -->
    <main class="main-content">
        <!-- è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯ -->
        <section class="stock-header">
            <div class="container">
                <div class="stock-info">
                    <div class="stock-name-section">
                        <h1 class="stock-name">å¹³å®‰é“¶è¡Œ</h1>
                        <span class="stock-code">000001</span>
                        <button class="watchlist-toggle">â­ è‡ªé€‰</button>
                    </div>
                    <div class="stock-price-section">
                        <div class="current-price">--</div>
                        <div class="price-change positive">--</div>
                        <div class="price-time">--</div>
                    </div>
                </div>
                
                <div class="stock-details">
                    <div class="detail-item">
                        <span class="label">ä»Šå¼€</span>
                        <span class="value">--</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">æ˜¨æ”¶</span>
                        <span class="value">--</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">æœ€é«˜</span>
                        <span class="value">--</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">æœ€ä½</span>
                        <span class="value">--</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">å‡ä»·</span>
                        <span class="value">--</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">æˆäº¤é‡</span>
                        <span class="value">--</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">æˆäº¤é¢</span>
                        <span class="value">--</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">æ¢æ‰‹ç‡</span>
                        <span class="value">--</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">å¸‚ç›ˆç‡</span>
                        <span class="value">--</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- å›¾è¡¨åŒºåŸŸ -->
        <section class="chart-section">
            <div class="container">
                <div class="chart-container">
                    <div class="chart-controls">
                        <div class="chart-type-tabs">
                            <button class="tab-btn active" data-type="kline">Kçº¿</button>
                            <button class="tab-btn" data-type="minute">åˆ†æ—¶</button>
                        </div>
                        <div class="chart-period-tabs">
                            <button class="period-btn" data-period="1m">1åˆ†</button>
                            <button class="period-btn" data-period="5m">5åˆ†</button>
                            <button class="period-btn" data-period="15m">15åˆ†</button>
                            <button class="period-btn" data-period="30m">30åˆ†</button>
                            <button class="period-btn" data-period="1h">1å°æ—¶</button>
                            <button class="period-btn active" data-period="1d">æ—¥K</button>
                            <button class="period-btn" data-period="1w">å‘¨K</button>
                            <button class="period-btn" data-period="1M">æœˆK</button>
                        </div>
                        <div class="chart-indicators">
                            <select class="indicator-select">
                                <option value="ma">MAå‡çº¿</option>
                                <option value="ema">EMAå‡çº¿</option>
                                <option value="boll">å¸ƒæ—å¸¦</option>
                            </select>
                            <select class="sub-indicator-select">
                                <option value="vol">æˆäº¤é‡</option>
                                <option value="macd">MACD</option>
                                <option value="kdj">KDJ</option>
                                <option value="rsi">RSI</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <div id="klineChart" class="chart"></div>
                        <div id="minuteChart" class="chart" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- å†…å®¹æ ‡ç­¾åŒºåŸŸ -->
        <section class="content-tabs">
            <div class="container">
                <div class="tab-nav">
                    <button class="content-tab active" data-tab="analysis">æ™ºèƒ½åˆ†æ</button>
                    <button class="content-tab" data-tab="finance">è´¢åŠ¡æ•°æ®</button>
                    <button class="content-tab" data-tab="news">æ–°é—»å…¬å‘Š</button>
                    <button class="content-tab" data-tab="research">ç ”æŠ¥</button>
                    <button class="content-tab" data-tab="flow">èµ„é‡‘æµå‘</button>
                </div>
                
                <div class="tab-content">
                    <!-- æ™ºèƒ½åˆ†æ -->
                    <div class="tab-panel active" id="analysis">
                        <div class="analysis-grid">
                            <div class="analysis-card">
                                <h3>ğŸ¯ ä»·æ ¼é¢„æµ‹</h3>
                                <div class="prediction-result">
                                    <div class="prediction-price">
                                        <span class="target-price">13.50</span>
                                        <span class="prediction-change positive">+9.41%</span>
                                    </div>
                                    <div class="prediction-range">
                                        <span>é¢„æµ‹åŒºé—´ï¼š12.80 - 14.20</span>
                                    </div>
                                    <div class="confidence">
                                        <span>ç½®ä¿¡åº¦ï¼š75%</span>
                                        <span>é¢„æµ‹å‘¨æœŸï¼š30å¤©</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="analysis-card">
                                <h3>ğŸ“Š äº¤æ˜“å»ºè®®</h3>
                                <div class="recommendation-result">
                                    <div class="action-badge buy">å»ºè®®ä¹°å…¥</div>
                                    <div class="recommendation-reasons">
                                        <div class="reason-item positive">âœ“ æŠ€æœ¯æŒ‡æ ‡çœ‹å¤š</div>
                                        <div class="reason-item positive">âœ“ æˆäº¤é‡æŒç»­æ”¾å¤§</div>
                                        <div class="reason-item positive">âœ“ çªç ´é‡è¦é˜»åŠ›ä½</div>
                                        <div class="reason-item warning">âš  æ³¨æ„å¤§ç›˜é£é™©</div>
                                    </div>
                                    <div class="risk-level">
                                        <span>é£é™©ç­‰çº§ï¼š</span>
                                        <span class="risk-badge medium">ä¸­ç­‰</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="analysis-card">
                                <h3>ğŸ“ˆ æŠ€æœ¯æŒ‡æ ‡</h3>
                                <div class="technical-indicators">
                                    <div class="indicator-row">
                                        <span class="indicator-name">RSI(14)</span>
                                        <span class="indicator-value">65.4</span>
                                        <span class="indicator-signal neutral">ä¸­æ€§</span>
                                    </div>
                                    <div class="indicator-row">
                                        <span class="indicator-name">MACD</span>
                                        <span class="indicator-value">0.124</span>
                                        <span class="indicator-signal bullish">çœ‹å¤š</span>
                                    </div>
                                    <div class="indicator-row">
                                        <span class="indicator-name">KDJ</span>
                                        <span class="indicator-value">75.2</span>
                                        <span class="indicator-signal bearish">çœ‹ç©º</span>
                                    </div>
                                    <div class="indicator-row">
                                        <span class="indicator-name">å¸ƒæ—å¸¦</span>
                                        <span class="indicator-value">ä¸Šè½¨</span>
                                        <span class="indicator-signal bullish">çœ‹å¤š</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="analysis-card">
                                <h3>ğŸ¯ å…³é”®ä»·ä½</h3>
                                <div class="key-levels">
                                    <div class="level-item">
                                        <span class="level-label">é˜»åŠ›ä½3</span>
                                        <span class="level-value resistance">7.82</span>
                                    </div>
                                    <div class="level-item">
                                        <span class="level-label">é˜»åŠ›ä½2</span>
                                        <span class="level-value resistance">7.48</span>
                                    </div>
                                    <div class="level-item">
                                        <span class="level-label">é˜»åŠ›ä½1</span>
                                        <span class="level-value resistance">7.14</span>
                                    </div>
                                    <div class="level-item current">
                                        <span class="level-label">å½“å‰ä»·</span>
                                        <span class="level-value">6.80</span>
                                    </div>
                                    <div class="level-item">
                                        <span class="level-label">æ”¯æ’‘ä½1</span>
                                        <span class="level-value support">6.46</span>
                                    </div>
                                    <div class="level-item">
                                        <span class="level-label">æ”¯æ’‘ä½2</span>
                                        <span class="level-value support">6.12</span>
                                    </div>
                                    <div class="level-item">
                                        <span class="level-label">æ”¯æ’‘ä½3</span>
                                        <span class="level-value support">5.78</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- è´¢åŠ¡æ•°æ® -->
                    <div class="tab-panel" id="finance">
                        <div class="finance-grid">
                            <div class="finance-section">
                                <h3>ä¸»è¦è´¢åŠ¡æŒ‡æ ‡(æœ€æ–°æŠ¥å‘ŠæœŸ)</h3>
                                <table class="finance-table">
                                    <tr>
                                        <td>å¸‚ç›ˆç‡(TTM)</td>
                                        <td id="pe">-</td>
                                        <td>å¸‚å‡€ç‡</td>
                                        <td id="pb">-</td>
                                    </tr>
                                    <tr>
                                        <td>å‡€èµ„äº§æ”¶ç›Šç‡(ROE)</td>
                                        <td id="roe">-</td>
                                        <td>èµ„äº§æ”¶ç›Šç‡(ROA)</td>
                                        <td id="roa">-</td>
                                    </tr>
                                    <tr>
                                        <td>è¥ä¸šæ”¶å…¥</td>
                                        <td id="revenue">-</td>
                                        <td>å‡€åˆ©æ¶¦</td>
                                        <td id="profit">-</td>
                                    </tr>
                                    <tr>
                                        <td>æ¯è‚¡æ”¶ç›Š(EPS)</td>
                                        <td id="eps">-</td>
                                        <td>æ¯è‚¡å‡€èµ„äº§(BPS)</td>
                                        <td id="bps">-</td>
                                    </tr>
                                </table>
                            </div>
                            
                            <div class="finance-section">
                                <h3>ç›ˆåˆ©èƒ½åŠ›</h3>
                                <div class="chart-placeholder">
                                    <div id="profitChart" style="height: 300px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ–°é—»å…¬å‘Š -->
                    <div class="tab-panel" id="news">
                        <div class="news-list-container">
                            <div class="news-filter">
                                <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
                                <button class="filter-btn" data-filter="announcement">å…¬å‘Š</button>
                                <button class="filter-btn" data-filter="news">æ–°é—»</button>
                                <button class="filter-btn" data-filter="research">ç ”æŠ¥</button>
                            </div>
                            <div class="news-items">
                                <div class="news-card">
                                    <div class="news-meta">
                                        <span class="news-date">2025-01-20</span>
                                        <span class="news-type announcement">å…¬å‘Š</span>
                                    </div>
                                    <h4 class="news-title">å¹³å®‰é“¶è¡Œ2024å¹´å¹´åº¦ä¸šç»©é¢„å‘Š</h4>
                                    <p class="news-summary">å…¬å¸é¢„è®¡2024å¹´å½’å±äºä¸Šå¸‚å…¬å¸è‚¡ä¸œçš„å‡€åˆ©æ¶¦ä¸º350-360äº¿å…ƒï¼ŒåŒæ¯”å¢é•¿5%-8%...</p>
                                </div>
                                
                                <div class="news-card">
                                    <div class="news-meta">
                                        <span class="news-date">2025-01-19</span>
                                        <span class="news-type news">æ–°é—»</span>
                                    </div>
                                    <h4 class="news-title">é“¶è¡Œè‚¡é›†ä½“èµ°å¼ºï¼Œå¹³å®‰é“¶è¡Œæ¶¨è¶…5%</h4>
                                    <p class="news-summary">å—åˆ©å¥½æ”¿ç­–å½±å“ï¼Œé“¶è¡Œæ¿å—ä»Šæ—¥è¡¨ç°å¼ºåŠ²ï¼Œå¹³å®‰é“¶è¡Œé¢†æ¶¨...</p>
                                </div>
                                
                                <div class="news-card">
                                    <div class="news-meta">
                                        <span class="news-date">2025-01-18</span>
                                        <span class="news-type announcement">å…¬å‘Š</span>
                                    </div>
                                    <h4 class="news-title">å…³äºå¬å¼€2024å¹´åº¦è‚¡ä¸œå¤§ä¼šçš„é€šçŸ¥</h4>
                                    <p class="news-summary">å…¬å¸å®šäº2025å¹´3æœˆ15æ—¥å¬å¼€2024å¹´åº¦è‚¡ä¸œå¤§ä¼š...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ç ”æŠ¥ -->
                    <div class="tab-panel" id="research">
                        <div class="research-list">
                            <div class="research-item">
                                <div class="research-header">
                                    <h4>å¹³å®‰é“¶è¡Œï¼šä¸šç»©ç¨³å¥å¢é•¿ï¼Œç»´æŒä¹°å…¥è¯„çº§</h4>
                                    <div class="research-meta">
                                        <span class="research-firm">ä¸­ä¿¡è¯åˆ¸</span>
                                        <span class="research-date">2025-01-20</span>
                                        <span class="research-rating buy">ä¹°å…¥</span>
                                    </div>
                                </div>
                                <div class="research-target">
                                    <span>ç›®æ ‡ä»·ï¼š15.00å…ƒ</span>
                                    <span class="target-upside positive">+21.6%</span>
                                </div>
                                <p class="research-summary">å…¬å¸2024å¹´ä¸šç»©è¡¨ç°ç¨³å¥ï¼Œèµ„äº§è´¨é‡æŒç»­æ”¹å–„ï¼Œå»ºè®®ä¹°å…¥...</p>
                            </div>
                            
                            <div class="research-item">
                                <div class="research-header">
                                    <h4>å¹³å®‰é“¶è¡Œï¼šé›¶å”®è½¬å‹æˆæ•ˆæ˜¾è‘—</h4>
                                    <div class="research-meta">
                                        <span class="research-firm">æ‹›å•†è¯åˆ¸</span>
                                        <span class="research-date">2025-01-18</span>
                                        <span class="research-rating hold">æŒæœ‰</span>
                                    </div>
                                </div>
                                <div class="research-target">
                                    <span>ç›®æ ‡ä»·ï¼š13.50å…ƒ</span>
                                    <span class="target-upside positive">+9.4%</span>
                                </div>
                                <p class="research-summary">é›¶å”®ä¸šåŠ¡è½¬å‹æˆæ•ˆæ˜æ˜¾ï¼Œä½†éœ€å…³æ³¨æ¯å·®æ”¶çª„å‹åŠ›...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- èµ„é‡‘æµå‘ -->
                    <div class="tab-panel" id="flow">
                        <div class="flow-summary">
                            <div class="flow-item">
                                <span class="flow-label">ä»Šæ—¥ä¸»åŠ›æµå…¥</span>
                                <span class="flow-value positive">+2.34äº¿</span>
                            </div>
                            <div class="flow-item">
                                <span class="flow-label">ä»Šæ—¥è¶…å¤§å•æµå…¥</span>
                                <span class="flow-value positive">+1.56äº¿</span>
                            </div>
                            <div class="flow-item">
                                <span class="flow-label">ä»Šæ—¥å¤§å•æµå…¥</span>
                                <span class="flow-value positive">+0.78äº¿</span>
                            </div>
                            <div class="flow-item">
                                <span class="flow-label">ä»Šæ—¥ä¸­å•æµå…¥</span>
                                <span class="flow-value negative">-1.23äº¿</span>
                            </div>
                            <div class="flow-item">
                                <span class="flow-label">ä»Šæ—¥å°å•æµå…¥</span>
                                <span class="flow-value negative">-1.11äº¿</span>
                            </div>
                        </div>
                        <div class="flow-chart">
                            <div id="flowChart" style="height: 400px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- ICPå¤‡æ¡ˆä¿¡æ¯ -->
    <footer class="icp-footer">
        <div class="icp-container">
            <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer">
                äº¬ICPå¤‡18061239å·-1
            </a>
        </div>
    </footer>

    <script src="js/config.js"></script>
    <script src="js/common.js"></script>
    <script src="components/header.js"></script>
    <script>
        // ç¡®ä¿API_BASE_URLå·²å®šä¹‰ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰
        (function() {
            if (typeof API_BASE_URL === 'undefined') {
                const apiUrl = (typeof Config !== 'undefined' && Config && Config.getApiBaseUrl) 
                    ? Config.getApiBaseUrl() 
                    : 'http://192.168.31.237:5000';
                window.API_BASE_URL = apiUrl;
            }
        })();
        
        // ç¡®ä¿echartså·²åŠ è½½ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰
        if (typeof echarts === 'undefined') {
            console.warn('echartsæœªåŠ è½½ï¼Œå°è¯•ä»CDNåŠ è½½');
            const echartsScript = document.createElement('script');
            echartsScript.src = 'https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js';
            echartsScript.onerror = function() {
                console.error('echarts CDNåŠ è½½ä¹Ÿå¤±è´¥');
            };
            document.head.appendChild(echartsScript);
        }
        
        // æ ¹æ®è‚¡ç¥¨ç±»å‹åŠ¨æ€åŠ è½½å¯¹åº”çš„JSæ–‡ä»¶
        (async function() {
            // ä»URLè·å–è‚¡ç¥¨ä»£ç 
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            
            if (!code) {
                console.error('ç¼ºå°‘è‚¡ç¥¨ä»£ç å‚æ•°');
                return;
            }
            
            // ç¡®ä¿API_BASE_URLå¯ç”¨ï¼ˆä½¿ç”¨å…¨å±€å˜é‡ï¼‰
            const apiBaseUrl = (typeof API_BASE_URL !== 'undefined' && API_BASE_URL) 
                ? API_BASE_URL 
                : ((typeof window.API_BASE_URL !== 'undefined' && window.API_BASE_URL) 
                    ? window.API_BASE_URL 
                    : 'http://192.168.31.237:5000');
            
            try {
                // è°ƒç”¨åˆ¤æ–­æ¥å£
                const response = await fetch(`${apiBaseUrl}/api/stock/check_type?code=${code}`);
                const result = await response.json();
                
                if (result.success) {
                    // æ ¹æ®is_hkå­—æ®µåŠ è½½å¯¹åº”çš„JSæ–‡ä»¶
                    const jsFile = result.is_hk ? 'js/stock_hk.js' : 'js/stock.js';
                    console.log(`è‚¡ç¥¨ç±»å‹: ${result.is_hk ? 'æ¸¯è‚¡' : 'Aè‚¡'}ï¼ŒåŠ è½½æ–‡ä»¶: ${jsFile}`);
                    
                    // åŠ¨æ€åŠ è½½JSæ–‡ä»¶
                    const script = document.createElement('script');
                    script.src = jsFile;
                    script.onload = function() {
                        console.log(`${jsFile} åŠ è½½å®Œæˆ`);
                        // JSæ–‡ä»¶åŠ è½½å®Œæˆåï¼Œåˆå§‹åŒ–StockPage
                        if (typeof StockPage !== 'undefined' && StockPage.init) {
                            StockPage.init();
                        }
                    };
                    script.onerror = function() {
                        console.error(`åŠ è½½ ${jsFile} å¤±è´¥`);
                        CommonUtils.showToast('åŠ è½½è‚¡ç¥¨é¡µé¢è„šæœ¬å¤±è´¥', 'error');
                    };
                    document.body.appendChild(script);
                } else {
                    console.error('åˆ¤æ–­è‚¡ç¥¨ç±»å‹å¤±è´¥:', result.message);
                    // é»˜è®¤åŠ è½½Aè‚¡JS
                    const script = document.createElement('script');
                    script.src = 'js/stock.js';
                    script.onload = function() {
                        if (typeof StockPage !== 'undefined' && StockPage.init) {
                            StockPage.init();
                        }
                    };
                    document.body.appendChild(script);
                }
            } catch (error) {
                console.error('åˆ¤æ–­è‚¡ç¥¨ç±»å‹å¼‚å¸¸:', error);
                // å¼‚å¸¸æ—¶é»˜è®¤åŠ è½½Aè‚¡JS
                const script = document.createElement('script');
                script.src = 'js/stock.js';
                script.onload = function() {
                    if (typeof StockPage !== 'undefined' && StockPage.init) {
                        StockPage.init();
                    }
                };
                document.body.appendChild(script);
            }
        })();
    </script>
</body>
</html> 