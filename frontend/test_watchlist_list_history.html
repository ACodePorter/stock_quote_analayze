<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自选股列表视图历史按钮测试 - 股票分析</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/watchlist.css">
    <style>
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-button {
            margin: 10px;
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-family: monospace;
        }
        .view-controls {
            margin: 20px 0;
            text-align: center;
        }
        .view-btn {
            padding: 10px 20px;
            margin: 0 5px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 4px;
        }
        .view-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        .stocks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stocks-list {
            margin: 20px 0;
        }
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        .table th,
        .table td {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px;
            text-align: left;
        }
        .table th {
            background-color: #f5f5f5;
        }
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-right: 5px;
        }
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        .stock-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: white;
        }
        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .stock-basic h3 {
            margin: 0;
            font-size: 16px;
        }
        .stock-code {
            color: #666;
            font-size: 12px;
        }
        .stock-price {
            margin: 10px 0;
        }
        .current-price {
            font-size: 18px;
            font-weight: bold;
        }
        .price-change {
            margin-left: 10px;
        }
        .positive {
            color: #dc3545;
        }
        .negative {
            color: #28a745;
        }
        .stock-details {
            margin: 10px 0;
        }
        .detail-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        .stock-actions {
            margin-top: 15px;
        }
        .action-btn {
            padding: 6px 12px;
            margin-right: 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
        }
    </style>
</head>
<body>
    <!-- 头部导航将由JavaScript动态加载 -->
    <script src="components/header.js"></script>
    <script>loadHeader('test');</script>

    <!-- 主要内容 -->
    <main class="main-content">
        <div class="container">
            <h1>自选股列表视图历史按钮测试</h1>
            
            <!-- 视图切换控制 -->
            <div class="test-section">
                <h2>视图切换测试</h2>
                <div class="view-controls">
                    <button class="view-btn active" data-view="grid">网格视图</button>
                    <button class="view-btn" data-view="list">列表视图</button>
                </div>
                <p>点击按钮切换视图，验证列表视图中的历史按钮功能</p>
            </div>

            <!-- 自选股内容 -->
            <div class="watchlist-content">
                <!-- 网格视图 -->
                <div class="stocks-grid" id="stocksGrid">
                    <!-- 动态生成网格视图内容 -->
                </div>

                <!-- 列表视图 -->
                <div class="stocks-list" id="stocksList" style="display: none;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>股票</th>
                                <th>最新价</th>
                                <th>涨跌额</th>
                                <th>涨跌幅</th>
                                <th>今开</th>
                                <th>最高</th>
                                <th>最低</th>
                                <th>成交量</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="stocksTableBody">
                            <!-- 动态生成列表视图内容 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 功能测试 -->
            <div class="test-section">
                <h2>功能测试</h2>
                <button class="test-button" onclick="testGridView()">测试网格视图</button>
                <button class="test-button" onclick="testListView()">测试列表视图</button>
                <button class="test-button" onclick="testHistoryButton()">测试历史按钮</button>
                <button class="test-button" onclick="testViewSwitch()">测试视图切换</button>
            </div>

            <!-- 测试结果 -->
            <div class="test-section">
                <h2>测试结果</h2>
                <div id="testResults"></div>
            </div>
        </div>
    </main>

    <!-- 引入必要的JavaScript文件 -->
    <script src="js/config.js"></script>
    <script src="js/common.js"></script>
    
    <script>
        // 测试用的股票数据
        const testStocks = [
            { code: '000001', name: '平安银行', price: 12.34, change: 0.56, percent: 4.76, group: 'bank', open: 11.89, high: 12.45, low: 11.85, volume: '1.2亿' },
            { code: '600036', name: '招商银行', price: 45.67, change: 1.23, percent: 2.77, group: 'bank', open: 44.50, high: 45.89, low: 44.23, volume: '3.5亿' },
            { code: '600519', name: '贵州茅台', price: 1865.00, change: -12.50, percent: -0.67, group: 'consumption', open: 1875.00, high: 1890.00, low: 1860.00, volume: '0.8亿' },
            { code: '000858', name: '五粮液', price: 156.78, change: 3.45, percent: 2.25, group: 'consumption', open: 154.20, high: 158.90, low: 153.10, volume: '2.1亿' },
            { code: '002415', name: '海康威视', price: 32.45, change: 1.56, percent: 5.05, group: 'tech', open: 31.20, high: 32.67, low: 30.95, volume: '4.2亿' }
        ];

        let currentView = 'grid';

        // 格式化价格
        function formatPrice(price) {
            if (price === null || price === undefined) return '--';
            return parseFloat(price).toFixed(2);
        }

        // 格式化涨跌额
        function formatChange(change) {
            if (change === null || change === undefined) return '--';
            const value = parseFloat(change);
            return value >= 0 ? `+${value.toFixed(2)}` : value.toFixed(2);
        }

        // 格式化涨跌幅
        function formatPercent(percent) {
            if (percent === null || percent === undefined) return '--';
            const value = parseFloat(percent);
            return value >= 0 ? `+${value.toFixed(2)}%` : `${value.toFixed(2)}%`;
        }

        // 格式化成交量
        function formatVolume(volume) {
            if (!volume) return '--';
            return volume;
        }

        // 获取涨跌样式类
        function getChangeClass(value) {
            if (value === null || value === undefined) return '';
            return parseFloat(value) >= 0 ? 'positive' : 'negative';
        }

        // 渲染网格视图
        function renderGridView(stocks) {
            const grid = document.getElementById('stocksGrid');
            if (!stocks.length) {
                grid.innerHTML = '<div class="empty-tip" style="text-align:center;padding:2em 0;color:#888;font-size:1.2em;">暂无自选股</div>';
                return;
            }
            
            grid.innerHTML = stocks.map(stock => `
                <div class="stock-card" data-code="${stock.code}" data-group="${stock.group}">
                    <div class="stock-header">
                        <div class="stock-basic">
                            <h3 class="stock-name">${stock.name}</h3>
                            <span class="stock-code">${stock.code}</span>
                        </div>
                        <button class="remove-btn">×</button>
                    </div>
                    <div class="stock-price">
                        <span class="current-price">${formatPrice(stock.price)}</span>
                        <span class="price-change ${getChangeClass(stock.change)}">${formatChange(stock.change)}</span>
                        <span class="change-percent ${getChangeClass(stock.change)}">${formatPercent(stock.percent)}</span>
                    </div>
                    <div class="stock-details">
                        <div class="detail-row">
                            <span>今开</span>
                            <span>${formatPrice(stock.open)}</span>
                        </div>
                        <div class="detail-row">
                            <span>昨收</span>
                            <span>${formatPrice(stock.price - stock.change)}</span>
                        </div>
                        <div class="detail-row">
                            <span>最高</span>
                            <span class="positive">${formatPrice(stock.high)}</span>
                        </div>
                        <div class="detail-row">
                            <span>最低</span>
                            <span class="negative">${formatPrice(stock.low)}</span>
                        </div>
                    </div>
                    <div class="stock-actions">
                        <button class="action-btn" onclick="goToStock('${stock.code}', '${stock.name}')">详情</button>
                        <button class="action-btn trade-btn" onclick="goToStockHistory('${stock.code}')">历史</button>
                    </div>
                </div>
            `).join('');
        }

        // 渲染列表视图
        function renderListView(stocks) {
            const tbody = document.getElementById('stocksTableBody');
            if (!stocks.length) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;color:#888;font-size:1.2em;">暂无自选股</td></tr>';
                return;
            }

            tbody.innerHTML = stocks.map(stock => `
                <tr data-code="${stock.code}">
                    <td>
                        <div class="stock-info-cell">
                            <span class="stock-name">${stock.name}</span>
                            <span class="stock-code">${stock.code}</span>
                        </div>
                    </td>
                    <td>${formatPrice(stock.price)}</td>
                    <td class="${getChangeClass(stock.change)}">${formatChange(stock.change)}</td>
                    <td class="${getChangeClass(stock.percent)}">${formatPercent(stock.percent)}</td>
                    <td>${formatPrice(stock.open)}</td>
                    <td class="positive">${formatPrice(stock.high)}</td>
                    <td class="negative">${formatPrice(stock.low)}</td>
                    <td>${formatVolume(stock.volume)}</td>
                    <td style="min-width: 280px;">
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button class="btn btn-secondary" onclick="goToStock('${stock.code}', '${stock.name}')">详情</button>
                            <button class="btn btn-primary" onclick="goToStockHistory('${stock.code}')">历史</button>
                            <button class="btn btn-danger remove-btn">删除</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // 切换视图
        function switchView(view) {
            currentView = view;
            const gridView = document.getElementById('stocksGrid');
            const listView = document.getElementById('stocksList');

            if (view === 'grid') {
                gridView.style.display = 'grid';
                listView.style.display = 'none';
                renderGridView(testStocks);
            } else {
                gridView.style.display = 'none';
                listView.style.display = 'block';
                renderListView(testStocks);
            }

            // 更新活动视图按钮
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // 跳转到股票详情
        function goToStock(code, name) {
            addTestResult(`跳转到股票详情: ${name}(${code})`, 'info');
            // 实际项目中这里会跳转到股票详情页
            // window.location.href = `stock.html?code=${code}&name=${encodeURIComponent(name)}`;
        }

        // 跳转到股票历史
        function goToStockHistory(code) {
            addTestResult(`跳转到股票历史: ${code}`, 'info');
            // 实际项目中这里会跳转到股票历史页
            // window.location.href = `stock_history.html?code=${code}`;
        }

        // 测试函数
        function addTestResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const resultElement = document.createElement('div');
            resultElement.className = 'test-result';
            resultElement.style.borderLeft = `4px solid ${type === 'error' ? 'red' : type === 'success' ? 'green' : 'blue'}`;
            listView.style.display = 'block';
            renderListView(testStocks);
        }

        // 更新活动视图按钮
        function updateActiveView(activeBtn) {
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            activeBtn.classList.add('active');
        }

        // 测试函数
        function addTestResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const resultElement = document.createElement('div');
            resultElement.className = 'test-result';
            resultElement.style.borderLeft = `4px solid ${type === 'error' ? 'red' : type === 'success' ? 'green' : 'blue'}`;
            resultElement.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            resultsDiv.appendChild(resultElement);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        function testGridView() {
            addTestResult('开始测试网格视图...');
            switchView('grid');
            addTestResult('网格视图测试完成，包含详情和历史按钮', 'success');
        }

        function testListView() {
            addTestResult('开始测试列表视图...');
            switchView('list');
            addTestResult('列表视图测试完成，包含详情、历史和删除按钮', 'success');
        }

        function testHistoryButton() {
            addTestResult('开始测试历史按钮功能...');
            // 模拟点击历史按钮
            const historyButtons = document.querySelectorAll('button[onclick*="goToStockHistory"]');
            if (historyButtons.length > 0) {
                addTestResult(`找到 ${historyButtons.length} 个历史按钮`, 'success');
                historyButtons.forEach((btn, index) => {
                    addTestResult(`历史按钮 ${index + 1}: ${btn.textContent}`, 'info');
                });
            } else {
                addTestResult('未找到历史按钮', 'error');
            }
        }

        function testViewSwitch() {
            addTestResult('开始测试视图切换功能...');
            const currentViewText = currentView === 'grid' ? '网格视图' : '列表视图';
            addTestResult(`当前视图: ${currentViewText}`, 'info');
            
            // 测试切换到另一个视图
            const newView = currentView === 'grid' ? 'list' : 'grid';
            switchView(newView);
            addTestResult(`切换到: ${newView === 'grid' ? '网格视图' : '列表视图'}`, 'success');
        }

        // 绑定视图切换事件
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', (event) => {
                    switchView(event.target.dataset.view);
                });
            });

            // 初始化显示网格视图
            renderGridView(testStocks);
            
            addTestResult('页面初始化完成，默认显示网格视图', 'success');
        });
    </script>
</body>
</html>
