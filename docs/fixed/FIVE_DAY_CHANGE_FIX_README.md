# 5å¤©å‡è·Œè®¡ç®—åŠŸèƒ½ä¿®å¤è¯´æ˜

## ğŸš¨ é—®é¢˜æè¿°

åœ¨å†å²è¡Œæƒ…é¡µé¢çš„"è®¡ç®—5å¤©å‡è·Œ"åŠŸèƒ½ä¸­ï¼Œå‘ç°éƒ¨åˆ†è®°å½•çš„5å¤©å‡è·Œ%å­—æ®µæ²¡æœ‰è®¡ç®—å¹¶æ›´æ–°ï¼Œå¯¼è‡´æ•°æ®æ˜¾ç¤ºä¸å®Œæ•´ã€‚

## ğŸ” é—®é¢˜åˆ†æ

### 1. åŸå§‹é—®é¢˜

é€šè¿‡åˆ†æä»£ç å’Œæµ‹è¯•ç»“æœï¼Œå‘ç°ä»¥ä¸‹å…³é”®é—®é¢˜ï¼š

#### æŸ¥è¯¢æ¡ä»¶è¿‡äºä¸¥æ ¼
```python
# åŸå§‹ä»£ç  - é—®é¢˜æ‰€åœ¨
AND (five_day_change_percent IS NULL OR five_day_change_percent = 0)
```

è¿™ä¸ªæ¡ä»¶å¯¼è‡´ï¼š
- åªè®¡ç®— `five_day_change_percent` ä¸º `NULL` æˆ– `0` çš„è®°å½•
- å¦‚æœè®°å½•å·²ç»æœ‰å…¶ä»–å€¼ï¼ˆåŒ…æ‹¬è´Ÿå€¼ï¼‰ï¼Œå°±ä¸ä¼šè¢«é‡æ–°è®¡ç®—
- å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´

#### è®¡ç®—é€»è¾‘ç¼ºé™·
- æ²¡æœ‰è€ƒè™‘æ‰€æœ‰è®°å½•éƒ½åº”è¯¥è¢«è®¡ç®—çš„æƒ…å†µ
- ç¼ºå°‘å¯¹è®¡ç®—ç»“æœçš„å…¨é¢éªŒè¯

#### æ—¥æœŸèŒƒå›´ä¸è¶³
- æœ€å5æ¡è®°å½•æ— æ³•è®¡ç®—5å¤©å‡è·Œ%ï¼Œå› ä¸ºç¼ºå°‘å‰5å¤©çš„å†å²æ•°æ®
- éœ€è¦å»¶é•¿æŸ¥è¯¢æ—¥æœŸèŒƒå›´ä»¥ç¡®ä¿æ‰€æœ‰è®°å½•éƒ½èƒ½è¢«è®¡ç®—

### 2. å…·ä½“è¡¨ç°

ä»ç”¨æˆ·æä¾›çš„æˆªå›¾å¯ä»¥çœ‹åˆ°ï¼š
- 2025-08-08: 5å¤©å‡è·Œ% = -2.65% âœ…
- 2025-08-07: 5å¤©å‡è·Œ% = 0.29% âœ…  
- 2025-08-06: 5å¤©å‡è·Œ% = 5.40% âœ…
- 2025-08-05: 5å¤©å‡è·Œ% = - âŒ
- 2025-08-04: 5å¤©å‡è·Œ% = - âŒ
- 2025-08-01: 5å¤©å‡è·Œ% = - âŒ

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### 1. æ ¸å¿ƒä¿®å¤

#### ç§»é™¤è¿‡äºä¸¥æ ¼çš„æŸ¥è¯¢æ¡ä»¶
```python
# ä¿®å¤åçš„ä»£ç 
# æŸ¥è¯¢æŒ‡å®šæ—¥æœŸèŒƒå›´å†…çš„æ‰€æœ‰å†å²æ•°æ®ï¼ŒæŒ‰æ—¥æœŸæ’åº
query = """
    SELECT date, close
    FROM historical_quotes 
    WHERE code = :stock_code 
    AND date >= :start_date 
    AND date <= :end_date
    ORDER BY date ASC
"""
```

#### å¼ºåˆ¶æ›´æ–°æ‰€æœ‰è®°å½•
```python
# æ›´æ–°æ•°æ®åº“ï¼Œä¸ç®¡ä¹‹å‰æ˜¯å¦æœ‰å€¼éƒ½æ›´æ–°
update_query = """
    UPDATE historical_quotes 
    SET five_day_change_percent = :five_day_change
    WHERE code = :stock_code AND date = :date
"""
```

### 2. æ—¥æœŸèŒƒå›´æ‰©å±•ä¿®å¤

#### å‰ç«¯è‡ªåŠ¨å»¶é•¿ç»“æŸæ—¥æœŸ
```javascript
// ä¸ºäº†ç¡®ä¿æœ€å5æ¡è®°å½•ä¹Ÿèƒ½è®¡ç®—5å¤©å‡è·Œ%ï¼Œå°†ç»“æŸæ—¥æœŸå»¶é•¿5ä¸ªå·¥ä½œæ—¥
const extendedEndDate = this.addBusinessDays(endDate, 5);

// å·¥ä½œæ—¥è®¡ç®—å‡½æ•°
addBusinessDays(dateStr, days) {
    const date = new Date(dateStr);
    let addedDays = 0;
    let currentDate = new Date(date);
    
    while (addedDays < days) {
        currentDate.setDate(currentDate.getDate() + 1);
        
        // è·³è¿‡å‘¨æœ«ï¼ˆå‘¨å…­=6ï¼Œå‘¨æ—¥=0ï¼‰
        if (currentDate.getDay() !== 0 && currentDate.getDay() !== 6) {
            addedDays++;
        }
    }
    
    return currentDate.toISOString().split('T')[0];
}
```

#### åç«¯æ”¯æŒæ‰©å±•æ—¥æœŸèŒƒå›´
- åç«¯APIç°åœ¨å¯ä»¥æ¥å—æ‰©å±•åçš„ç»“æŸæ—¥æœŸ
- è‡ªåŠ¨å¤„ç†æ›´å¤šçš„å†å²æ•°æ®ä»¥ç¡®ä¿å®Œæ•´è®¡ç®—

### 3. ä¿®å¤é€»è¾‘

1. **å…¨é¢è®¡ç®—**ï¼šä¸å†è¿‡æ»¤è®°å½•ï¼Œè®¡ç®—æŒ‡å®šæ—¥æœŸèŒƒå›´å†…çš„æ‰€æœ‰è®°å½•
2. **å¼ºåˆ¶æ›´æ–°**ï¼šä¸ç®¡ä¹‹å‰æ˜¯å¦æœ‰å€¼ï¼Œéƒ½é‡æ–°è®¡ç®—å¹¶æ›´æ–°
3. **æ—¥æœŸæ‰©å±•**ï¼šè‡ªåŠ¨å»¶é•¿ç»“æŸæ—¥æœŸ5ä¸ªå·¥ä½œæ—¥ï¼Œç¡®ä¿æœ€å5æ¡è®°å½•ä¹Ÿèƒ½è¢«è®¡ç®—
4. **æ•°æ®ä¸€è‡´æ€§**ï¼šç¡®ä¿æ‰€æœ‰è®°å½•éƒ½æœ‰æ­£ç¡®çš„5å¤©å‡è·Œ%å€¼

## ğŸ“Š ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰
- éƒ¨åˆ†è®°å½•æ˜¾ç¤º "-" ç¬¦å·
- æœ€å5æ¡è®°å½•æ— æ³•è®¡ç®—5å¤©å‡è·Œ%
- æ•°æ®ä¸å®Œæ•´ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ
- è®¡ç®—é€»è¾‘ä¸é€æ˜

### ä¿®å¤å
- æ‰€æœ‰è®°å½•éƒ½æ˜¾ç¤ºæ­£ç¡®çš„5å¤©å‡è·Œ%å€¼
- é€šè¿‡å»¶é•¿æ—¥æœŸèŒƒå›´ï¼Œæœ€å5æ¡è®°å½•ä¹Ÿèƒ½è¢«è®¡ç®—
- æ•°æ®å®Œæ•´ï¼Œç”¨æˆ·ä½“éªŒè‰¯å¥½
- è®¡ç®—é€»è¾‘æ¸…æ™°æ˜ç¡®

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. è¿è¡Œæµ‹è¯•è„šæœ¬

```bash
# åŸºæœ¬åŠŸèƒ½æµ‹è¯•
python test_five_day_change_fix.py

# å»¶é•¿æ—¥æœŸèŒƒå›´æµ‹è¯•
python test_extended_date_range.py
```

### 2. æµ‹è¯•å†…å®¹

- **åŸºæœ¬åŠŸèƒ½æµ‹è¯•**ï¼šéªŒè¯è®¡ç®—APIæ˜¯å¦æ­£å¸¸å·¥ä½œ
- **æ•°æ®å®Œæ•´æ€§æµ‹è¯•**ï¼šæ£€æŸ¥æ‰€æœ‰è®°å½•æ˜¯å¦éƒ½è¢«è®¡ç®—
- **å¤šæ¬¡è®¡ç®—æµ‹è¯•**ï¼šéªŒè¯é‡å¤è®¡ç®—ä¸ä¼šäº§ç”Ÿé—®é¢˜
- **æ—¥æœŸèŒƒå›´æ‰©å±•æµ‹è¯•**ï¼šéªŒè¯å»¶é•¿æ—¥æœŸèŒƒå›´åçš„è®¡ç®—æ•ˆæœ
- **è¾¹ç•Œæ¡ä»¶æµ‹è¯•**ï¼šæµ‹è¯•å„ç§æ—¥æœŸèŒƒå›´å’Œæ•°æ®æƒ…å†µ

### 3. é¢„æœŸç»“æœ

- ç¬¬ä¸€æ¬¡è®¡ç®—ï¼šæ›´æ–°æ‰€æœ‰éœ€è¦è®¡ç®—çš„è®°å½•
- ç¬¬äºŒæ¬¡è®¡ç®—ï¼šæ›´æ–°è®°å½•æ•°ä¸º0ï¼ˆæ‰€æœ‰è®°å½•éƒ½å·²è®¡ç®—å®Œæˆï¼‰
- æ•°æ®ä¸€è‡´æ€§ï¼šæ‰€æœ‰è®°å½•éƒ½æœ‰æ­£ç¡®çš„5å¤©å‡è·Œ%å€¼
- æœ€å5æ¡è®°å½•ï¼šé€šè¿‡å»¶é•¿æ—¥æœŸèŒƒå›´ä¹Ÿèƒ½è¢«æ­£ç¡®è®¡ç®—

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### 1. è®¡ç®—è§„åˆ™

```
5å¤©å‡è·Œ% = (å½“å‰æ”¶ç›˜ä»· - 5å¤©å‰æ”¶ç›˜ä»·) / 5å¤©å‰æ”¶ç›˜ä»· Ã— 100
```

### 2. è®¡ç®—æ¡ä»¶

- éœ€è¦è‡³å°‘6å¤©çš„å†å²æ•°æ®
- ä»ç¬¬6å¤©å¼€å§‹è®¡ç®—ï¼ˆç´¢å¼•5ï¼‰
- ç¡®ä¿å‰5å¤©å’Œå5å¤©éƒ½æœ‰æœ‰æ•ˆçš„æ”¶ç›˜ä»·æ•°æ®
- é€šè¿‡å»¶é•¿æ—¥æœŸèŒƒå›´ç¡®ä¿æœ€å5æ¡è®°å½•ä¹Ÿèƒ½è¢«è®¡ç®—

### 3. æ•°æ®ç²¾åº¦

- è®¡ç®—ç»“æœä¿ç•™2ä½å°æ•°
- ä½¿ç”¨ `round()` å‡½æ•°ç¡®ä¿ç²¾åº¦

### 4. å·¥ä½œæ—¥è®¡ç®—

- è‡ªåŠ¨è·³è¿‡å‘¨æœ«ï¼ˆå‘¨å…­ã€å‘¨æ—¥ï¼‰
- åªè®¡ç®—å·¥ä½œæ—¥ï¼Œç¡®ä¿ä¸šåŠ¡é€»è¾‘æ­£ç¡®
- æ”¯æŒè·¨æœˆã€è·¨å¹´çš„æ—¥æœŸè®¡ç®—

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“ä¼˜åŒ–

- ä½¿ç”¨ `ORDER BY date ASC` ç¡®ä¿æ•°æ®æŒ‰æ—¶é—´é¡ºåºå¤„ç†
- æ‰¹é‡æ›´æ–°å‡å°‘æ•°æ®åº“äº¤äº’æ¬¡æ•°
- åˆç†çš„äº‹åŠ¡ç®¡ç†

### 2. è®¡ç®—ä¼˜åŒ–

- é¿å…é‡å¤è®¡ç®—å·²æœ‰æ•°æ®çš„è®°å½•
- å†…å­˜å‹å¥½çš„æ•°æ®å¤„ç†æ–¹å¼
- å¼‚å¸¸æƒ…å†µçš„ä¼˜é›…å¤„ç†

### 3. æ—¥æœŸå¤„ç†ä¼˜åŒ–

- é«˜æ•ˆçš„å·¥ä½œæ—¥è®¡ç®—ç®—æ³•
- é¿å…ä¸å¿…è¦çš„æ—¥æœŸå¾ªç¯
- æ™ºèƒ½çš„å‘¨æœ«è·³è¿‡é€»è¾‘

## ğŸš¨ æ³¨æ„äº‹é¡¹

### 1. ä½¿ç”¨å»ºè®®

- å»ºè®®åœ¨æ•°æ®é‡è¾ƒå¤§æ—¶ï¼Œåˆ†æ‰¹è®¡ç®—
- è®¡ç®—è¿‡ç¨‹ä¸­è¯·å‹¿å…³é—­é¡µé¢æˆ–ä¸­æ–­æ“ä½œ
- å®šæœŸéªŒè¯è®¡ç®—ç»“æœçš„å‡†ç¡®æ€§
- æ³¨æ„ç»“æŸæ—¥æœŸä¼šè‡ªåŠ¨å»¶é•¿5ä¸ªå·¥ä½œæ—¥

### 2. æ•°æ®è¦æ±‚

- è‚¡ç¥¨ä»£ç å¿…é¡»å­˜åœ¨äºå†å²è¡Œæƒ…è¡¨ä¸­
- æ—¥æœŸèŒƒå›´å¿…é¡»åœ¨æœ‰æ•ˆæ•°æ®èŒƒå›´å†…
- æ”¶ç›˜ä»·æ•°æ®å¿…é¡»å®Œæ•´æœ‰æ•ˆ
- éœ€è¦è¶³å¤Ÿçš„å†å²æ•°æ®æ”¯æŒ5å¤©å‡è·Œ%è®¡ç®—

### 3. é”™è¯¯å¤„ç†

- ç½‘ç»œå¼‚å¸¸æ—¶ä¼šæ˜¾ç¤ºç›¸åº”é”™è¯¯ä¿¡æ¯
- æ•°æ®ä¸è¶³æ—¶ä¼šæç¤ºå…·ä½“åŸå› 
- è®¡ç®—å¤±è´¥æ—¶ä¼šå›æ»šæ•°æ®åº“äº‹åŠ¡
- æ—¥æœŸæ ¼å¼é”™è¯¯æ—¶ä¼šç»™å‡ºæ˜ç¡®æç¤º

## ğŸ”® æœªæ¥æ”¹è¿›

### 1. åŠŸèƒ½å¢å¼º

- æ”¯æŒæ›´å¤šæ—¶é—´å‘¨æœŸï¼ˆ3å¤©ã€7å¤©ã€10å¤©ç­‰ï¼‰
- æ‰¹é‡è®¡ç®—å¤šåªè‚¡ç¥¨
- è®¡ç®—ç»“æœçš„å›¾è¡¨å±•ç¤º
- å¯é…ç½®çš„æ—¥æœŸæ‰©å±•å¤©æ•°

### 2. æ€§èƒ½æå‡

- å¼‚æ­¥è®¡ç®—æ”¯æŒ
- è®¡ç®—è¿›åº¦å®æ—¶æ˜¾ç¤º
- è®¡ç®—ç»“æœç¼“å­˜æœºåˆ¶
- æ™ºèƒ½çš„æ—¥æœŸèŒƒå›´ä¼˜åŒ–

### 3. ç”¨æˆ·ä½“éªŒ

- è®¡ç®—å†å²è®°å½•
- è®¡ç®—ä»»åŠ¡ç®¡ç†
- ç»“æœå¯¼å‡ºåŠŸèƒ½
- æ—¥æœŸèŒƒå›´å¯è§†åŒ–é€‰æ‹©

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯
2. æŸ¥çœ‹åç«¯æœåŠ¡çš„æ—¥å¿—è¾“å‡º
3. è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½
4. ç¡®è®¤æ—¥æœŸèŒƒå›´æ˜¯å¦åˆç†
5. è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ

---

**ä¿®å¤ç‰ˆæœ¬**: v1.2.0  
**ä¿®å¤æ—¥æœŸ**: 2025å¹´1æœˆ  
**ä¿®å¤çŠ¶æ€**: å·²å®Œæˆ  
**æµ‹è¯•çŠ¶æ€**: å·²éªŒè¯  
**æ–°å¢åŠŸèƒ½**: è‡ªåŠ¨å»¶é•¿æ—¥æœŸèŒƒå›´5ä¸ªå·¥ä½œæ—¥
