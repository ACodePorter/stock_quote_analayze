# 生产环境连接问题修复方案

## 问题分析

根据错误信息：
```
2025/09/11 14:56:15 [error] 5480#5940: *76835 connect() failed (10061: No connection could be made because the target machine actively refused it) while connecting to upstream, client: 39.155.167.162, server: www.icemaplecity.com, request: "GET / HTTP/2.0", upstream: "http://127.0.0.1:8000/", host: "www.icemaplecity.com"
```

**问题原因**：nginx无法连接到127.0.0.1:8000的前端服务

## 诊断结果

通过诊断脚本检查发现：
- ✅ **8000端口正常**：前端服务正在运行
- ❌ **80端口未运行**：nginx HTTP服务未启动
- ❌ **443端口未运行**：nginx HTTPS服务未启动
- ✅ **5000端口正常**：后端API服务正在运行
- ❌ **8001端口未运行**：管理后台未启动

## 根本原因

**主要问题**：nginx服务没有启动，导致无法处理外部请求

## 修复方案

### 方案1：启动nginx服务（推荐）

```bash
# 1. 检查nginx配置文件
cd C:\work\stock_quote_analayze\tools\nginx-1.28.0
nginx.exe -t

# 2. 启动nginx服务
nginx.exe

# 3. 检查nginx是否启动成功
netstat -ano | findstr :80
netstat -ano | findstr :443
```

### 方案2：使用正确的nginx配置文件

如果nginx配置文件路径不正确，需要：

```bash
# 1. 找到正确的nginx配置文件
# 2. 复制配置文件到nginx目录
copy nginx_complete.conf C:\work\stock_quote_analayze\tools\nginx-1.28.0\conf\nginx.conf

# 3. 重新加载nginx配置
nginx.exe -s reload
```

### 方案3：一键启动所有服务

使用创建的启动脚本：

```bash
# 运行启动脚本
start_production_services.bat
```

## 验证修复效果

### 1. 检查服务状态
```bash
# 检查所有服务端口
netstat -ano | findstr :80
netstat -ano | findstr :443
netstat -ano | findstr :8000
netstat -ano | findstr :5000
netstat -ano | findstr :8001
```

### 2. 测试访问
- 访问 https://www.icemaplecity.com/
- 检查是否正常显示前端页面
- 检查浏览器控制台是否有错误

### 3. 检查nginx日志
```bash
# 查看nginx错误日志
type C:\work\stock_quote_analayze\tools\nginx-1.28.0\logs\error.log

# 查看nginx访问日志
type C:\work\stock_quote_analayze\tools\nginx-1.28.0\logs\access.log
```

## 预防措施

### 1. 服务监控
建议设置服务监控，确保所有服务正常运行：
- nginx服务
- 前端服务（8000端口）
- 后端API服务（5000端口）
- 管理后台服务（8001端口）

### 2. 自动启动
可以将关键服务设置为Windows服务，实现自动启动。

### 3. 日志监控
定期检查nginx日志，及时发现连接问题。

## 总结

**问题根源**：nginx服务未启动
**解决方案**：启动nginx服务
**预期结果**：外部访问恢复正常，不再出现连接拒绝错误

修复后，用户应该能够正常访问 https://www.icemaplecity.com/ 网站。
