# K线不同时长类型数据切换测试

## 修复内容

已修复K线图表不同时长类型（1分、5分、15分、30分、1小时、日K、周K、月K）数据没有变化的问题。

## 主要修改

### 1. `loadKlineData()` 函数增强
- 根据 `currentPeriod` 动态选择不同的数据接口和参数
- 分钟级数据使用 `kline_min_hist` 接口
- 日线、周线、月线使用 `kline_hist` 接口
- 不同周期设置不同的时间范围和数据量

### 2. 模拟数据生成优化
- `generateMockKlineData()` 函数根据当前周期生成相应数量的数据点
- 1分钟：330个数据点（当天9:30-15:00）
- 5分钟：198个数据点（最近3天）
- 15分钟：154个数据点（最近7天）
- 30分钟：154个数据点（最近14天）
- 1小时：120个数据点（最近30天）
- 日线：90个数据点（最近90天）
- 周线：52个数据点（最近52周）
- 月线：24个数据点（最近24个月）

## 测试步骤

### 1. 启动应用程序
```bash
# 启动后端
cd backend_api
python main.py

# 启动前端（在另一个终端）
cd frontend
python -m http.server 8000
```

### 2. 访问股票详情页面
- 打开浏览器访问：`http://localhost:8000/stock.html?code=300453&name=测试股票`
- 确保K线图表正常显示

### 3. 测试不同时间周期
点击不同的时间周期按钮，观察图表数据变化：

#### 分钟级数据
- **1分**：应该显示当天的分钟级数据，X轴为时间（9:30-15:00）
- **5分**：应该显示最近3天的5分钟数据
- **15分**：应该显示最近7天的15分钟数据
- **30分**：应该显示最近14天的30分钟数据

#### 小时级数据
- **1小时**：应该显示最近30天的1小时数据

#### 日线及以上
- **日K**：应该显示最近90天的日线数据
- **周K**：应该显示最近52周的周线数据
- **月K**：应该显示最近24个月的月线数据

### 4. 验证数据变化
- 每次切换时间周期，图表应该重新加载数据
- 数据点数量应该根据周期变化
- X轴标签格式应该相应调整
- 控制台应该显示相应的日志信息

## 预期结果

1. **数据量变化**：不同时间周期显示不同数量的数据点
2. **时间格式变化**：分钟级显示时间，日线级显示日期
3. **图表更新**：每次切换都会重新请求数据并更新图表
4. **错误处理**：API失败时自动回退到模拟数据

## 故障排除

### 如果数据仍然没有变化：
1. 检查浏览器控制台是否有错误信息
2. 确认后端API是否支持相应的period参数
3. 验证网络请求是否正确发送

### 如果图表不显示：
1. 检查ECharts是否正确初始化
2. 确认DOM元素是否存在
3. 查看JavaScript错误日志

## 技术细节

### API调用逻辑
```javascript
// 分钟级数据
if (period === '1' || period === '5' || period === '15' || period === '30' || period === '60') {
    url = `${API_BASE_URL}/api/stock/kline_min_hist?code=${code}&period=${period}&start_datetime=${startTime}&end_datetime=${endTime}&adjust=qfq`;
} else {
    // 日线、周线、月线
    url = `${API_BASE_URL}/api/stock/kline_hist?code=${code}&period=${period}&start_date=${startDate}&end_date=${endDate}&adjust=qfq`;
}
```

### 数据映射
- 分钟级数据：`item.date` 作为时间标签
- 日线级数据：`item.date` 作为日期标签
- 价格数据：统一使用 `[open, close, low, high, volume]` 格式

## 总结

通过这次修复，K线图表现在能够：
1. 根据用户选择的时间周期动态加载相应的数据
2. 自动选择正确的API接口
3. 生成相应数量的模拟数据作为备用
4. 提供更好的用户体验和数据可视化效果
