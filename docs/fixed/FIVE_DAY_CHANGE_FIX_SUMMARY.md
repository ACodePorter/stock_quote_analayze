# 5å¤©å‡è·Œè®¡ç®—ä¿®å¤å®Œæˆæ€»ç»“

## ğŸ‰ ä¿®å¤æˆåŠŸ

ç»è¿‡åˆ†æå’Œä¿®å¤ï¼Œ5å¤©å‡è·Œè®¡ç®—åŠŸèƒ½çš„é—®é¢˜å·²ç»å®Œå…¨è§£å†³ã€‚æµ‹è¯•ç»“æœæ˜¾ç¤ºï¼š

- âœ… **APIæœåŠ¡æ­£å¸¸**ï¼šåç«¯æœåŠ¡æˆåŠŸå¯åŠ¨å¹¶å“åº”
- âœ… **æŸ¥è¯¢åŠŸèƒ½æ­£å¸¸**ï¼šæˆåŠŸæŸ¥è¯¢åˆ°21æ¡å†å²è®°å½•
- âœ… **è®¡ç®—åŠŸèƒ½æ­£å¸¸**ï¼šæˆåŠŸè®¡ç®—å¹¶æ›´æ–°äº†21æ¡è®°å½•çš„5å¤©å‡è·Œ%
- âœ… **æœ€å5å¤©æ•°æ®**ï¼šæ‰€æœ‰æœ€å5å¤©çš„æ•°æ®éƒ½æˆåŠŸè®¡ç®—äº†5å¤©å‡è·Œ%
- âœ… **è¾¹ç•Œæƒ…å†µå¤„ç†**ï¼šæ­£ç¡®å¤„ç†äº†æ•°æ®ä¸è¶³ç­‰å¼‚å¸¸æƒ…å†µ

## ğŸ”§ ä¿®å¤å†…å®¹

### 1. é—®é¢˜è¯Šæ–­
- **æ ¹æœ¬åŸå› **ï¼šåç«¯APIåœ¨è®¡ç®—5å¤©å‡è·Œæ—¶ï¼ŒåªæŸ¥è¯¢äº†ç”¨æˆ·æŒ‡å®šçš„æ—¥æœŸèŒƒå›´å†…çš„æ•°æ®ï¼Œä½†æ²¡æœ‰è€ƒè™‘åˆ°è®¡ç®—5å¤©å‡è·Œéœ€è¦å‰5å¤©çš„æ•°æ®
- **å…·ä½“è¡¨ç°**ï¼šæœ€å5å¤©çš„5å¤©å‡è·Œ%å­—æ®µä¸ºç©ºï¼Œæ— æ³•è®¡ç®—

### 2. ä¿®å¤æ–¹æ¡ˆ
- **æ‰©å±•æŸ¥è¯¢èŒƒå›´**ï¼šè‡ªåŠ¨è®¡ç®—å¼€å§‹æ—¥æœŸå‰5ä¸ªå·¥ä½œæ—¥ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿçš„å‰5å¤©æ•°æ®
- **æ·»åŠ è¾…åŠ©å‡½æ•°**ï¼š`_get_date_before_business_days()` å‡½æ•°è®¡ç®—å‰Nä¸ªå·¥ä½œæ—¥
- **é™åˆ¶æ›´æ–°èŒƒå›´**ï¼šåªæ›´æ–°ç”¨æˆ·æŒ‡å®šæ—¥æœŸèŒƒå›´å†…çš„è®°å½•ï¼Œé¿å…å½±å“å…¶ä»–æ•°æ®

### 3. ä¿®å¤çš„ä»£ç 
```python
# æ‰©å±•æŸ¥è¯¢èŒƒå›´
extended_start_date = _get_date_before_business_days(start_date_fmt, 5)

extended_query = """
    SELECT date, close
    FROM historical_quotes 
    WHERE code = :stock_code 
    AND date >= :extended_start_date 
    AND date <= :end_date
    ORDER BY date ASC
"""

# åªæ›´æ–°ç”¨æˆ·æŒ‡å®šæ—¥æœŸèŒƒå›´å†…çš„è®°å½•
if current_quote.date >= start_date_fmt and current_quote.date <= end_date_fmt:
    # è®¡ç®—å’Œæ›´æ–°é€»è¾‘
```

## ğŸ“Š æµ‹è¯•ç»“æœ

### æµ‹è¯•ç¯å¢ƒ
- **è‚¡ç¥¨ä»£ç **ï¼š603667ï¼ˆäº”æ´²æ–°æ˜¥ï¼‰
- **æ—¥æœŸèŒƒå›´**ï¼š2025-08-03 åˆ° 2025-09-02
- **æ€»è®°å½•æ•°**ï¼š26æ¡ï¼ˆåŒ…å«æ‰©å±•çš„å‰5å¤©æ•°æ®ï¼‰
- **æ›´æ–°è®°å½•æ•°**ï¼š21æ¡ï¼ˆç”¨æˆ·æŒ‡å®šèŒƒå›´å†…çš„è®°å½•ï¼‰

### æµ‹è¯•éªŒè¯
```
å‰5æ¡è®°å½•çš„5å¤©å‡è·Œ%æƒ…å†µ:
  2025-09-01: -3.22% (âœ… å·²è®¡ç®—)
  2025-08-29: -2.33% (âœ… å·²è®¡ç®—)
  2025-08-28: -2.5% (âœ… å·²è®¡ç®—)
  2025-08-27: -6.85% (âœ… å·²è®¡ç®—)
  2025-08-26: -5.79% (âœ… å·²è®¡ç®—)

ğŸ“Š æµ‹è¯•ç»“æœ: 5/5 æ¡è®°å½•æˆåŠŸè®¡ç®—5å¤©å‡è·Œ%
ğŸ‰ æµ‹è¯•é€šè¿‡ï¼æ‰€æœ‰æœ€å5å¤©æ•°æ®éƒ½æˆåŠŸè®¡ç®—äº†5å¤©å‡è·Œ%
```

## ğŸ“ ç›¸å…³æ–‡ä»¶

### ä¿®æ”¹çš„æ–‡ä»¶
- `backend_api/stock/history_api.py` - ä¸»è¦ä¿®å¤é€»è¾‘

### æ–°å¢çš„æ–‡ä»¶
- `test/test_five_day_change_fix.py` - æµ‹è¯•è„šæœ¬
- `docs/fixed/FIVE_DAY_CHANGE_CALCULATION_FIX.md` - è¯¦ç»†ä¿®å¤è¯´æ˜

## ğŸš€ ä½¿ç”¨è¯´æ˜

ç°åœ¨ç”¨æˆ·å¯ä»¥æ­£å¸¸ä½¿ç”¨5å¤©å‡è·Œè®¡ç®—åŠŸèƒ½ï¼š

1. **é€‰æ‹©è‚¡ç¥¨**ï¼šåœ¨å†å²è¡Œæƒ…é¡µé¢é€‰æ‹©è¦è®¡ç®—çš„è‚¡ç¥¨
2. **è®¾ç½®æ—¥æœŸèŒƒå›´**ï¼šé€‰æ‹©å¼€å§‹æ—¥æœŸå’Œç»“æŸæ—¥æœŸ
3. **ç‚¹å‡»è®¡ç®—**ï¼šç‚¹å‡»"è®¡ç®—5å¤©å‡è·Œ"æŒ‰é’®
4. **æŸ¥çœ‹ç»“æœ**ï¼šæ‰€æœ‰æŒ‡å®šæ—¥æœŸèŒƒå›´å†…çš„æ•°æ®ï¼ˆåŒ…æ‹¬æœ€å5å¤©ï¼‰éƒ½ä¼šæ­£ç¡®è®¡ç®—5å¤©å‡è·Œ%

## âœ¨ æ”¹è¿›æ•ˆæœ

### ä¿®å¤å‰
- âŒ æœ€å5å¤©çš„5å¤©å‡è·Œ%å­—æ®µä¸ºç©º
- âŒ ç”¨æˆ·éœ€è¦æ‰‹åŠ¨è°ƒæ•´æ—¥æœŸèŒƒå›´æ‰èƒ½è®¡ç®—å®Œæ•´æ•°æ®
- âŒ ç”¨æˆ·ä½“éªŒä¸ä½³

### ä¿®å¤å
- âœ… æ‰€æœ‰æŒ‡å®šæ—¥æœŸèŒƒå›´å†…çš„æ•°æ®éƒ½èƒ½æ­£ç¡®è®¡ç®—5å¤©å‡è·Œ%
- âœ… åŒ…æ‹¬æœ€å5å¤©çš„æ•°æ®
- âœ… ç”¨æˆ·ä½“éªŒæ›´åŠ æµç•…
- âœ… ç³»ç»Ÿæ›´åŠ ç¨³å®šå¯é 

## ğŸ¯ æ€»ç»“

é€šè¿‡æ‰©å±•æŸ¥è¯¢èŒƒå›´å¹¶æ·»åŠ å·¥ä½œæ—¥è®¡ç®—é€»è¾‘ï¼ŒæˆåŠŸè§£å†³äº†æœ€å5å¤©æ•°æ®æ— æ³•è®¡ç®—5å¤©å‡è·Œ%çš„é—®é¢˜ã€‚ä¿®å¤åçš„ç³»ç»Ÿèƒ½å¤Ÿæ­£ç¡®å¤„ç†æ‰€æœ‰æ—¥æœŸèŒƒå›´å†…çš„æ•°æ®ï¼Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚

**ä¿®å¤çŠ¶æ€ï¼šâœ… å®Œæˆ**
